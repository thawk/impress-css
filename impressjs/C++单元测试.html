<!DOCTYPE html>
<html lang="zh">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width" />
        <title>C++单元测试</title>
        <!-- <link href="css/normalize.css" rel="stylesheet" /> -->
        <link href="css/typo.css" rel="stylesheet" />
        <link href="css/basscss.css" rel="stylesheet" />
        <link href="impress.js/css/impress-common.css" rel="stylesheet" />
        <link href="impress.js/extras/highlight/styles/github.css" rel="stylesheet" />
        <link href="css/classic-slides.css" rel="stylesheet" />
        <style type="text/css">
#title .cpp-logo {
    font-size: 110%;
}
pre {
    padding: 5px 15px;
    line-height: 1;
}
footer {
    text-align: right;
}
.impress-on-define #title .cpp-logo {
    opacity: 0;
}
.impress-on-title #define {
    opacity: 0;
}
.impress-on-can-repeat #independence {
    opacity: 0;
}
.impress-on-independence #impress #can-repeat div {
    opacity: 1;
}
#can-repeat div {
    position: absolute;
    top: 400px;
    width: 100%;
    margin: 0;
    text-align: center;
}
code {
    font-size: 60%;
}
#can-fail .cross {
    position: absolute;
    left: 8em;
    font-size: 150%;
}
#manual-expectation h4,
#alternate-logic h4,
#try-fail h4 {
    font-size: 150%;
}
#frameworks div {
    position: absolute;
    width: 100%;
    margin: 0;
    padding: 0;
    top: 400px;
}
.impress-on-frameworks #frameworks h3 {
    transition: font-size 1s;
}
.impress-on-boost-test #frameworks h3,
.impress-on-turtle #frameworks h3 {
    transition: font-size 1s;
    font-size: 80%;
}
#boost-test p, #turtle p {
    margin-top: 0;
    margin-bottom: 0;
}
        </style>
    </head>
<body class="impress-not-supported">
<div class="fallback-message">
    <p>Your browser <b>doesn't support the features required</b> by impress.js, so you are presented with a simplified version of this presentation.</p>
    <p>For the best experience please use the latest <b>Chrome</b>, <b>Safari</b> or <b>Firefox</b> browser.</p>
</div>
<div id="impress" class="typo" data-width="1920" data-height="1080" data-autoplay="0">

<div id="title" class="step slide title" data-x="0" data-y="0">
    <h1><span class="cpp-logo accent2">C++</span>单元测试</h1>
</div>

<div id="define" class="step fade-in" data-rel-x="0" data-rel-y="900" data-rotate=90>
    <blockquote>
    <p>在计算机编程中，<b class="accent">单元测试</b>（<b class="accent">Unit Testing</b>）又称为模块测试，是针对程序模块（软件设计的最小单位）来进行正确性检验的测试工作。<br>
    程序单元是应用的<b class="accent2">最小</b>可测试部件。<br>
    在过程化编程中，一个单元就是单个<b class="accent2">程序、函数、过程</b>等；对于面向对象编程，最小单元就是<b class="accent2">方法</b>，包括基类（超类）、抽象类、或者派生类（子类）中的方法。</p>
    <footer>—— 维基百科</footer>
    </blockquote>
</div>

<div id="keypoint" class="step title" data-rel-x=-1920  data-rel-y=420 data-rotate=0>
    <h2>单元测试要点</h2>
</div>

<div id="has-expectation" class="step slide" data-rel-x=420 data-rel-y=1600 data-rotate=90>
    <h3>有期望</h3>
    <p class="center">不为了覆盖率而覆盖率</p>
    <div class="substep">
        <pre><code class="lang-cpp">
BOOST_CHECK_EQUAL(prog.Start(), error_code());
BOOST_CHECK(prog.IsStarted());</code></pre>
        <pre><code class="lang-cpp">MOCK_EXPECT(prog.SendMessage)
  .once()
  .with(order);
prog.HandleOrder(order);
        </code></pre>
    </div>
</div>

<div id="can-fail" class="step slide" data-rel-x=-1080 data-rel-y=0 data-rotate=90>
    <h3>会失败</h3>
    <pre><span class="cross error substep">❌</span><code class="lang-cpp">BOOST_CHECK_EQUAL(prog.Func1(), prog.Func1());    // 自比较</code></pre>
</div>

<div id="manual-expectation" class="step slide" data-rel-x=-300 data-rel-y=-550 data-scale=0.3 data-rotate=90>
    <h4>人工确定预期</h4>
    <pre class="only-present"><code class="lang-cpp">
BOOST_CHECK_EQUAL(prog.Start(), error_code());
BOOST_CHECK(prog.IsStarted());</code></pre>
</div>

<div id="alternate-logic" class="step slide" data-rel-x=-0 data-rel-y=600 data-scale=0.3 data-rotate=90>
    <h4>与另一个算法对比</h4>
    <div class="only-present">
        <p>用与被测算法不同，但结果相同的算法</p>
        <ul>
            <li>性能较差的算法</li>
            <li>灵活性较差的算法</li>
        </ul>
    </div>
</div>

<div id="try-fail" class="step slide" data-rel-x=-0 data-rel-y=600 data-scale=0.3 data-rotate=90>
    <h4>故意失败</h4>
    <p class="only-present">编写用例后，故意使用错误的预期，验证用例会失败，证明用例的正确性</p>
</div>

<!-- 根据上一个H3（can-fail）进行定位 -->
<div id="can-repeat" class="step slide" data-rel-x=-1080 data-rel-y=0 data-rel-to="can-fail" data-rotate=90>
    <h3>可重复</h3>
    <div class="substep">
        <p class="center accent3 font-larger5">独立</p>
    </div>
</div>

<div id="independence" class="step slide" data-rel-x=-450 data-rel-y=0 data-rotate=90>
    <div class="inline-block col-5 align-top">
        <h4>环境独立</h4>
        <ul>
            <li>主机</li>
            <li>用户</li>
            <li>目录：<small>使用相对路径</small></li>
            <li>网络</li>
            <li>数据</li>
        </ul>
    </div>
    <div class="substep inline-block col-5 align-top">
        <h4>时间独立</h4>
        <ul>
            <li>系统时间</li>
            <li>执行时序</li>
        </ul>
    </div>
</div>

<div id="frameworks" class="step slide" data-rel-x=-1920 data-rel-y=0 data-rel-to="title" data-rotate=180>
    <h2>单元测试框架</h2>
    <div>
        <h3 class="inline-block col-5 align-middle center">Boost.Test</h3>
        <h3 class="inline-block col-5 align-middle center">Turtle</h3>
    </div>
</div>

<div id="boost-test" class="step slide" data-rel-x=480 data-rel-y=-150 data-rotate=180 data-scale=0.5>
    <p class="line-height-4">&nbsp;</p>
    <p class="line-height-4">&nbsp;</p>
    <ul class="only-present">
        <li>
            <p><strong>断言</strong></p>
            <p><code>BOOST_CHECK_EQUAL</code> / <code>BOOST_REQUIRE_EQUAL</code></p>
        </li>
        <li class="substep">
            <p><strong>Fixture</strong></p>
            <p><code>BOOST_FIXTURE_TEST_SUITE</code> / <code>BOOST_AUTO_TEST_CASE</code></p>
        </li>
        <li class="substep">
            <p><strong>数据集</strong></p>
            <p><code>BOOST_DATA_TEST_CASE</code> / <code>BOOST_DATA_TEST_CASE_F</code></p>
            <p><code class="accent1">lib/cppf/common/unittest/util/test_cont_rate_ctrl.cpp</code></p>
        </li>
    </ul>
</div>

<div id="turtle" class="step slide" data-rel-x=-480 data-rel-y=-150 data-rel-to="frameworks" data-rotate=180 data-scale=0.5>
    <p class="line-height-4">&nbsp;</p>
    <p class="line-height-4">&nbsp;</p>
    <ul class="only-present">
        <li>
            <p><strong>MOCK</strong></p>
            <p>注意写对类型名称、顺序等信息</p>
        </li>
        <li class="substep">
            <pre class="right"><code class="lang-cpp"><span class="accent1">MOCK_EXPECT</span>(preotocol_proc-&gt;DoSendMsg)
    .once()
    .with(...)
    .returns(OK);
protocol_proc-&gt;<span class="accent1">ProcMsg</span>(connection, msg);

<span class="accent2">mock::verify()</span>;

MOCK_EXPECT(preotocol_proc-&lt;DoSendMsg)
    ...</code></pre>
            </code></pre>
            <p><strong>EXPECT</strong></p>
            <p>先检查，再调用</p>
            <p>一般情况下应明确次数、参数</p>
        </li>
        <li class="substep">
            <p><strong>VERIFY</strong></p>
            <p>复杂测试需要进行中途验证</p>
            <p><code>mock::verify();</code></p>
        </li>
    </ul>
</div>

<!-- trade/share/include/sscc/trade/share/unittest/unittest_helper.h -->
<!-- ConstructedMessage()/EqualMessage()/RetrieveMessage()/RetrieveCallback() -->
<!--  -->
<!-- util/include/sscc/util/unittest/unittest_helper.h -->
<!-- InitMessage()/CountedCallback/WaitTill() -->

<div id="overview" class="step" data-x="-2000" data-y="1000" data-scale=5>
</div>

</div> <!-- #impress -->

<div id="impress-toolbar"></div>

<div class="impress-progressbar"><div></div></div>
<div class="impress-progress"></div>

<!-- <div id="impress-help"></div> -->

<script src="impress.js/js/impress.js" charset="utf-8"></script>
<script charset="utf-8">impress().init();</script>
<script src="impress.js/extras/highlight/highlight.pack.js" charset="utf-8"></script>
<script>hljs.initHighlightingOnLoad();</script>
</body>
</html>
